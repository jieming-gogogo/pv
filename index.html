<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>P/V 计算器</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="P/V计算器">
  <meta name="theme-color" content="#007bff">
  <style>
    *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}
    html,body{height:100%;margin:0;padding:0}
    body{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:env(safe-area-inset-top) 12px env(safe-area-inset-bottom);background:#f2f6fc;color:#333;font-size:clamp(14px,2.8vw,18px)}
    h1{font-size:clamp(20px,5vw,28px);margin:.5em 0;text-align:center}
    label{display:block;margin:.6em 0 .2em;font-weight:600}
    select,input{width:100%;max-width:480px;padding:.6em .8em;border:1px solid #ccc;border-radius:6px;font-size:inherit}
    button{width:100%;max-width:480px;margin:.3em 0;padding:.6em;border:none;border-radius:6px;background:#007bff;color:#fff;font-size:inherit;cursor:pointer}
    button:hover{background:#0056b3}
    .result{max-width:480px;margin-top:1em;padding:.8em;border-left:4px solid #007bff;background:#e9f7fe;word-break:break-word}
    @media (max-width:480px){body{padding:12px}}
  </style>
</head>
<body>
  <h1>生物反应器 P/V 计算器</h1>

  <label>反应器类型
    <select id="type">
      <option value="">--请选择--</option>
      <option value="GE-XDR500">GE-XDR500</option>
      <option value="Hyclone-SUB100">Hyclone-SUB100</option>
      <option value="Hyclone-SUB500">Hyclone-SUB500</option>
      <option value="Sartorius-200">Sartorius-200</option>
      <option value="Applikon-3L">Applikon-3L</option>
      <option value="Applikon-15L">Applikon-15L</option>
      <option value="Sartorius-50">Sartorius-50</option>
      <option value="BBI-3L">BBI-3L</option>
      <option value="GE-XDR50">GE-XDR50</option>
      <option value="Sartorius-500">Sartorius-500</option>
    </select>
  </label>

  <label>反应体积 (L)<input type="number" id="V" placeholder="例如 100"></label>

  <label>P/V (W/m³)<input type="number" id="pv" placeholder="留空则计算"></label>

  <label>转速 (RPM)<input type="number" id="rpm" placeholder="留空则计算"></label>

  <button onclick="calc()">计算</button>
  <button onclick="reset()">重置</button>

  <div id="res" class="result">等待计算…</div>

  <script>
    const data = {
      "GE-XDR500": {ne: 1.15, d: 0.2667},
      "Hyclone-SUB100": {ne: 2.1, d: 0.146},
      "Hyclone-SUB500": {ne: 2.1, d: 0.251},
      "Sartorius-200": {ne: 1.1, d: 0.225},
      "Applikon-3L": {ne: 1.5, d: 0.045},
      "Applikon-15L": {ne: 1.5, d: 0.075},
      "Sartorius-50": {ne: 1.4, d: 0.143},
      "BBI-3L": {ne: 0.7, d: 0.052},
      "GE-XDR50": {ne: 1.15, d: 0.21},
      "Sartorius-500": {ne: 1.3, d: 0.31}
    };
    const ρ = 1000;

    function calc() {
      const type = document.getElementById('type').value;
      const V = parseFloat(document.getElementById('V').value);
      const pv = parseFloat(document.getElementById('pv').value);
      const rpm = parseFloat(document.getElementById('rpm').value);
      const res = document.getElementById('res');

      if (!type || !V) { res.textContent = '请选择反应器并输入体积'; return; }
      const {ne, d} = data[type];
      const V_m3 = V / 1000;

      if (pv && !rpm) {
        const n = Math.pow(pv * V_m3 / (ne * ρ * Math.pow(d, 5)), 1/3);
        const rpm_calc = n * 60;
        document.getElementById('rpm').value = rpm_calc.toFixed(1);
        res.textContent = `转速 ≈ ${rpm_calc.toFixed(1)} RPM`;
      } else if (rpm && !pv) {
        const n = rpm / 60;
        const pv_calc = (ne * ρ * Math.pow(n, 3) * Math.pow(d, 5)) / V_m3;
        document.getElementById('pv').value = pv_calc.toFixed(2);
        res.textContent = `P/V ≈ ${pv_calc.toFixed(2)} W/m³`;
      } else {
        res.textContent = '请只填 P/V 或转速其一';
      }
    }

    function reset() {
      ['type', 'V', 'pv', 'rpm'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('res').textContent = '等待计算…';
    }

    // Service Worker（内联最小化）
    const sw = `
      const CACHE = 'pv-calc-v1';
      const FILES = ['./', './index.html'];
      self.addEventListener('install', e => e.waitUntil(caches.open(CACHE).then(c => c.addAll(FILES))));
      self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
    `;
    const blob = new Blob([sw], {type: 'application/javascript'});
    const url = URL.createObjectURL(blob);
    navigator.serviceWorker?.register(url);
  </script>
</body>
</html>
